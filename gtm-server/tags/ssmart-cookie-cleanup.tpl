___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Smart Cookie Cleanup",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/jpeg;base64,/9j/2wCEAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDIBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAcwBzAMBIgACEQEDEQH/xAGiAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgsQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+gEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoLEQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/ANGiiiviD9GCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKTP0/OgnH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AUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFAH/9k\u003d"
  },
  "description": "Deletes cookies by exact name or wildcard. Optionally parses a client-side cookie string to match and remove dynamic keys. Useful for cleanup, consent, or debugging.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "CHECKBOX",
    "name": "parse_client_side_cookie_string",
    "checkboxText": "Parse client side cookies sent as a parameter",
    "simpleValueType": true,
    "help": "When checked, you are able to specify a parameter holding cookie information pass as a string from the client side. \n\nThis will enable wildcard patters, such as _ga*, deleting all cookies found in the string starting with _ga.\n\nWhen not checked, cookie names given in the table below will be processed as is."
  },
  {
    "type": "SELECT",
    "name": "cookie_string",
    "displayName": "Source variable for client side cookies",
    "macrosInSelect": true,
    "selectItems": [],
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "parse_client_side_cookie_string",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "SIMPLE_TABLE",
    "name": "cookie_list",
    "displayName": "Cookies to delete",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Cookie Name",
        "name": "cookie_name",
        "type": "TEXT"
      },
      {
        "defaultValue": "",
        "displayName": "domain",
        "name": "domain",
        "type": "TEXT"
      },
      {
        "defaultValue": "",
        "displayName": "path",
        "name": "path",
        "type": "TEXT"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "group1",
    "displayName": "How to use?",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "LABEL",
        "name": "document_1",
        "displayName": "Deletes cookies by exact name or wildcard pattern.\nTo use wildcards, enable “Parse client-side cookie string” and pass document.cookie as cookie_string in the event data."
      },
      {
        "type": "LABEL",
        "name": "document_2",
        "displayName": "‎"
      },
      {
        "type": "LABEL",
        "name": "document_3",
        "displayName": "1. Provide a cookie_list array with one or more cookie objects:"
      },
      {
        "type": "LABEL",
        "name": "document_4",
        "displayName": "‎‎ ‎  ‎ ‎ • cookie name: exact name or wildcard (e.g. *_id)"
      },
      {
        "type": "LABEL",
        "name": "document_5",
        "displayName": "‎  ‎  ‎ ‎ • Optional: domain, path"
      },
      {
        "type": "LABEL",
        "name": "document_6",
        "displayName": "‎"
      },
      {
        "type": "LABEL",
        "name": "document_7",
        "displayName": "2. (Optional) Enable parse client side cookies to match wildcards against cookies present in cookie_string."
      },
      {
        "type": "LABEL",
        "name": "document_8",
        "displayName": "‎"
      },
      {
        "type": "LABEL",
        "name": "document_9",
        "displayName": "3. If parsing is enabled, you must pass document.cookie from the browser to the Server container (e.g. via GA4 or a custom event)."
      },
      {
        "type": "LABEL",
        "name": "document_10",
        "displayName": "‎"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const log                      = require('logToConsole');
const createRegex              = require('createRegex');
const testRegex                = require('testRegex');
const set_cookie               = require("setCookie");
const cookies_to_delete        = data.cookie_list || [];
const cookies_from_client_side = data.cookie_string || "";
let client_side_cookie_keys    = [];
let message = "";

// Utility function to delete a cookie
const delete_cookie = (cookie_name, domain, path, message) => 
{
  
  const normalized_domain = domain.indexOf('.') === 0 ? domain : "." + domain || 'auto';
  
  log("normalized_domain: " + normalized_domain);
  
  set_cookie(cookie_name, 'deleted', {
    domain: normalized_domain || 'auto',
    expires: 'Thu, 01 Jan 1970 00:00:00 GMT',
    path: path || '/'
  });
  log(message);
};

// Parse client-side cookie keys if enabled
const parse_enabled = data.parse_client_side_cookie_string;

log('cookies_from_client_side: ' + cookies_from_client_side);

if (parse_enabled && cookies_from_client_side.length > 0) 
{
  client_side_cookie_keys = cookies_from_client_side.split(";").map(cookie => cookie.split("=")[0].trim());
}

// Delete cookies
cookies_to_delete.forEach(cookie => 
{ 
  const is_wildcard = parse_enabled && cookie.cookie_name.indexOf('*') > -1;
  
  log("is_wildecard: " + is_wildcard);
  
  if (is_wildcard) 
  {
    
    const pattern = createRegex('^' + cookie.cookie_name.replace('*', '.*') + '$', '');
    
    client_side_cookie_keys.forEach(key => 
    {
      let is_match = testRegex(pattern, key);
      
      log("Pattern: " + pattern + " KEY: " + key + " MTATCH: " + is_match);
      
      if (is_match) 
      {
        message = "Cooike Name: '" + key + "' did match the pattern: " + pattern + " and was deleted";
        delete_cookie(key, cookie.domain, cookie.path, message);
      }
    });
  } 
  else 
  {
    message = "Cooike Name: '" + cookie.cookie_name + "' was deleted";
    delete_cookie(cookie.cookie_name, cookie.domain, cookie.path, message);
  }
});

data.gtmOnSuccess();


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Process Client Side Cookies
  code: |-
    const mockData = {
      parse_client_side_cookie_string: true,
      cookie_string: 'FPLC=some-fpgsid-value; ai_session=some-ai-session-id; _ga=som-ga-value: _ga_abcde=some-other-value',
      cookie_list: [{"cookie_name":"_ga*","domain":".example.com","path":"/"},{"cookie_name":"FPID","domain":"ihm.se","path":"/"}]
    };

    runCode(mockData);

    assertApi('gtmOnSuccess').wasCalled();


___NOTES___

Created on 10/07/2025, 11:05:54


